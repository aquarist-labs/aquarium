<div fxLayout="column"
     fxLayoutAlign="start stretch">
  <glass-alert-panel *ngIf="config?.hint"
                     type="hint">
    <div [innerHTML]="config?.hint! | translate | sanitize:'html'"></div>
  </glass-alert-panel>
  <p *ngIf="config?.subtitle"
     [innerHTML]="config?.subtitle! | translate | sanitize:'html'">
  </p>
  <form *ngIf="formGroup && config"
        [formGroup]="formGroup"
        [attr.id]="config.id"
        fxLayout="column"
        novalidate>
    <ng-container *ngFor="let field of config.fields; let i = index">
      <ng-container [ngSwitch]="field.type">
        <ng-template [ngSwitchCase]="'password'">
          <div class="form-group"
               [class]="field.groupClass">
            <label *ngIf="field.label"
                   class="col-form-label">
              {{ field.label | translate }}
            </label>
            <div class="input-group">
              <input #passwordInput
                     class="form-control"
                     type="password"
                     autocorrect="off"
                     autocapitalize="none"
                     [ngClass]="{'is-invalid': !formGroup.get(field.name)!.pristine && formGroup.get(field.name)!.invalid}"
                     [formControlName]="field.name"
                     [readonly]="field.readonly"
                     [required]="field.validators?.required!"
                     [autofocus]="field.autofocus"
                     (paste)="onPaste(field, $event)">
              <div class="input-group-append">
                <button type="button"
                        class="btn btn-outline-default"
                        title="{{ passwordInput.type === 'password' ? 'Show' : 'Hide' | translate }}"
                        (click)="passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password'">
                  <i class="mdi mdi-eye-outline"></i>
                </button>
                <button type="button"
                        class="btn btn-outline-default"
                        title="{{ 'Copy to clipboard' | translate }}"
                        (click)="onCopyToClipboard(field)">
                  <i class="mdi mdi-content-copy"></i>
                </button>
              </div>
            </div>
            <small *ngIf="field.hint && field.hint.length > 0 && formGroup.get(field.name)!.valid"
                   class="form-text text-muted"
                   [innerHTML]="field.hint | translate | sanitize:'html'">
            </small>
            <span *ngIf="formGroup.hasError('required', field.name)"
                  class="invalid-feedback"
                  translate>
              This field is required.
            </span>
            <span *ngIf="formGroup.hasError('pattern', field.name)"
                  class="invalid-feedback"
                  translate>
              The value is invalid.
            </span>
            <span *ngIf="formGroup.hasError('minLength', field.name)"
                  class="invalid-feedback"
                  translate>
              Minimum length is {{ field.validators?.minLength }} characters.
            </span>
            <span *ngIf="formGroup.hasError('maxLength', field.name)"
                  class="invalid-feedback"
                  translate>
              Maximum length is {{ field.validators?.maxLength }} characters.
            </span>
          </div>
        </ng-template>

        <ng-template [ngSwitchCase]="'text'">
          <div class="form-group"
               [class]="field.groupClass">
            <label *ngIf="field.label"
                   class="col-form-label">
              {{ field.label | translate }}
            </label>
            <div class="input-group">
              <input class="form-control"
                     type="text"
                     [ngClass]="{'is-invalid': !formGroup.get(field.name)!.pristine && formGroup.get(field.name)!.invalid}"
                     [formControlName]="field.name"
                     [readonly]="field.readonly"
                     [required]="field.validators?.required!"
                     [autofocus]="field.autofocus"
                     (paste)="onPaste(field, $event)">
              <div class="input-group-append">
                <button type="button"
                        class="btn btn-outline-default"
                        title="{{ 'Copy to clipboard' | translate }}"
                        (click)="onCopyToClipboard(field)">
                  <i class="mdi mdi-content-copy"></i>
                </button>
              </div>
            </div>
            <small *ngIf="field.hint && field.hint.length > 0 && formGroup.get(field.name)!.valid"
                   class="form-text text-muted"
                   [innerHTML]="field.hint | translate | sanitize:'html'">
            </small>
            <span *ngIf="formGroup.hasError('required', field.name)"
                  class="invalid-feedback"
                  translate>
              This field is required.
            </span>
            <span *ngIf="formGroup.hasError('pattern', field.name)"
                  class="invalid-feedback"
                  translate>
              The value is invalid.
            </span>
            <span *ngIf="formGroup.hasError('hostAddress', field.name)"
                  class="invalid-feedback"
                  translate>
              This field must be an IP address or FQDN.
            </span>
            <span *ngIf="formGroup.hasError('minLength', field.name)"
                  class="invalid-feedback"
                  translate>
              Minimum length is {{ field.validators?.minLength }} characters.
            </span>
            <span *ngIf="formGroup.hasError('maxLength', field.name)"
                  class="invalid-feedback"
                  translate>
              Maximum length is {{ field.validators?.maxLength }} characters.
            </span>
          </div>
        </ng-template>

        <ng-template [ngSwitchCase]="'number'">
          <div class="form-group"
               [class]="field.groupClass">
            <label *ngIf="field.label"
                   class="col-form-label">
              {{ field.label | translate }}
            </label>
            <div class="input-group">
              <input class="form-control"
                     type="text"
                     inputmode="numeric"
                     [ngClass]="{'is-invalid': !formGroup.get(field.name)!.pristine && formGroup.get(field.name)!.invalid}"
                     [formControlName]="field.name"
                     [readonly]="field.readonly"
                     [required]="field.validators?.required!"
                     [autofocus]="field.autofocus"
                     (paste)="onPaste(field, $event)">
              <div class="input-group-append">
                <button type="button"
                        class="btn btn-outline-default"
                        title="{{ 'Copy to clipboard' | translate }}"
                        (click)="onCopyToClipboard(field)">
                  <i class="mdi mdi-content-copy"></i>
                </button>
              </div>
            </div>
            <small *ngIf="field.hint && field.hint.length > 0 && formGroup.get(field.name)!.valid"
                   class="form-text text-muted"
                   [innerHTML]="field.hint | translate | sanitize:'html'">
            </small>
            <span *ngIf="formGroup.hasError('required', field.name)"
                  class="invalid-feedback"
                  translate>
              This field is required.
            </span>
            <span *ngIf="formGroup.hasError('min', field.name)"
                  class="invalid-feedback"
                  translate>
              The value must be at least {{ field.validators?.min }}.
            </span>
            <span *ngIf="formGroup.hasError('max', field.name)"
                  class="invalid-feedback"
                  translate>
              The value cannot exceed {{ field.validators?.max }}.
            </span>
          </div>
        </ng-template>

        <ng-template [ngSwitchCase]="'token'">
          <div class="form-group"
               [class]="field.groupClass">
            <label *ngIf="field.label"
                   class="col-form-label">
              {{ field.label | translate }}
            </label>
            <glass-token-input [formControlName]="field.name"
                               [required]="field.validators?.required!"
                               (paste)="onPaste(field, $event)">
            </glass-token-input>
            <small *ngIf="field.hint && field.hint.length > 0 && formGroup.get(field.name)!.valid"
                   class="form-text text-muted"
                   [innerHTML]="field.hint | translate | sanitize:'html'">
            </small>
            <span *ngIf="formGroup.hasError('required', field.name)"
                  class="invalid-feedback"
                  translate>
              This field is required.
            </span>
          </div>
        </ng-template>

        <ng-template [ngSwitchCase]="'checkbox'">
          <div class="form-group"
               [class]="field.groupClass">
            <div class="form-check">
              <input class="form-check-input"
                     type="checkbox"
                     [ngClass]="{'is-invalid': !formGroup.get(field.name)!.pristine && formGroup.get(field.name)!.invalid}"
                     [id]="field.name"
                     [formControlName]="field.name"
                     [checked]="field.value"
                     [required]="field.validators?.required!">
              <label class="form-check-label"
                     [for]="field.name">
                {{ field.label! | translate }}
              </label>
              <small *ngIf="field.hint && field.hint.length > 0 && formGroup.get(field.name)!.valid"
                     class="form-text text-muted"
                     [innerHTML]="field.hint | translate | sanitize:'html'">
              </small>
              <span *ngIf="formGroup.hasError('required', field.name)"
                    class="invalid-feedback"
                    translate>
                This field is required.
              </span>
            </div>
          </div>
        </ng-template>

        <ng-template [ngSwitchCase]="'radio'">
          <div class="form-group"
               [class]="field.groupClass">
            <div class="custom-control custom-radio">
              <input class="custom-control-input"
                     type="radio"
                     [ngClass]="{'is-invalid': !formGroup.get(field.name)!.pristine && formGroup.get(field.name)!.invalid}"
                     [id]="field.name + i"
                     [formControlName]="field.name"
                     [value]="field.value">
              <label class="custom-control-label"
                     [for]="field.name + i">
                {{ field.label! | translate }}
              </label>
              <small *ngIf="field.hint && field.hint.length > 0 && formGroup.get(field.name)!.valid"
                     class="form-text text-muted"
                     [innerHTML]="field.hint | translate | sanitize:'html'">
              </small>
            </div>
          </div>
        </ng-template>
      </ng-container>
    </ng-container>

    <div class="form-actions"
         fxLayout="row"
         fxLayoutAlign="end center">
      <ng-container *ngFor="let button of config.buttons">
        <ng-container [ngSwitch]="button.type">
          <ng-template [ngSwitchCase]="'default'">
            <button type="button"
                    class="btn btn-outline-dark"
                    [class]="button.class">
              {{ button.text! | translate }}
            </button>
          </ng-template>

          <ng-template [ngSwitchCase]="'submit'">
            <glass-submit-button [form]="formGroup"
                                 [formId]="config.id">
              {{ button.text! | translate }}
            </glass-submit-button>
          </ng-template>
        </ng-container>
      </ng-container>
    </div>
  </form>
</div>
